:imagesdir: ../../assets/images

= Activity: Enabling GitLab Entity Discovery

include::../style.adoc[]

Now that the import of User and Group entities and authentication is enabled for those same users, let's focus on importing more Entities from your Git repositories. Having a rich and complete Software Catalog increases the value of your IDP.

== Enable GitLab Entity Discovery 

Much like the Keycloak provider, you can use a https://backstage.io/docs/integrations/gitlab/discovery/[GitLab provider to discover^, window="console"] and import Entities from repositories in GitLab. This functionality is provided by the
https://npmjs.com/package/@backstage/plugin-catalog-backend-module-gitlab/v/0.3.21[@backstage/plugin-catalog-backend-module-gitlab plugin^, window="content"]. You can see that this is a supported https://docs.redhat.com/en/documentation/red_hat_developer_hub/1.6/html/dynamic_plugins_reference/con-preinstalled-dynamic-plugins[dynamic plugin in the {product_name_rhdh} documentation^, window="content"].

To install and configure this plugin:

. Visit the https://gitlab-gitlab.{openshift_cluster_ingress_domain}/pe{team-id}/developer-hub-config/-/blob/main/values.yaml[developer-hub-config repository^, window="gitlab"] in your GitLab instance.
. Select *Edit > Edit single file*.
+
[NOTE]
====
To uncomment multiple lines of code, highlight the lines and press `CMD + /` (on macOS) or `CTRL + /` (on Linux/Windows).
====

. Find the `appConfig.catalog.providers` configuration and uncomment the `--- GITLAB_CATALOG_PROVIDER ---` block as shown below. +
+
image:m2/gitlab-catalog-provider.png[GitLab Catalog Provider, width=70%]
// . Verify that your indentation matches that shown in the screenshot,
. Commit your changes with the message `feat: add GitLab autodiscovery`.
// +
// image:m2/gitlab-discovery.png[GitLab code editor showing catalog providers configuration for {product_name_rhdh}]
. Click the *Refresh* button on the https://openshift-gitops-server-openshift-gitops.{openshift_cluster_ingress_domain}/applications[`RHDH` Application in OpenShift GitOps^, window="argo"] (login as *`{pe-username}` / `{common_password}`*).

== Verify GitLab Entity Discovery is Active

. After a few moments, your new {product_name_rhdh} configuration will finish rolling out. Check the logs for the new https://console-openshift-console.{openshift_cluster_ingress_domain}/k8s/ns/rhdh-{team-id}/core%7Ev1%7EPod[{product_name_rhdh} Pod^, window="console"]. You should see that a repository was discovered - that means the repository contains https://backstage.io/docs/features/software-catalog/descriptor-format/[catalog-info.yaml, window="blank"] file.
+
image:m2/rhdh-logs-gitlab-discovery.png[GitLab Autodiscovery Logs in the OpenShift Console]

.If the pod is running but there is no change on Developer Hub UI, have look here 
[%collapsible]
====
include::../debug-pod-placement.adoc[]
====



== Quiz

Be prepared to answer our questions based on what you have learnt in this section! 

Wrap up the job done for your peers. Explain which capabilities (Authentication / Source Code Management / Users ..) have been added to the internal developer platform. The quiz will happen after the break !


image::m2/quizz-time.png[{product_name_rhdh} deployment on OpenShift]

== Conclusion

Congratulations! You've learned the core concepts of Backstage and {product_name_rhdh}. You also learned how to deploy and manage an instance of {product_name_rhdh} using the official Helm Chart via OpenShift GitOps.