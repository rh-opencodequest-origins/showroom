:imagesdir: ../../assets/images

== Developer Activity: Create a new Component from the Template

IMPORTANT: Please make sure you are logged in as a Developer with `dev1` / `{common_password}` as you were guided to in the previous step.

include::../style.adoc[]

Create a new software Component and supporting infrastructure using the *Quarkus Service* template that was created by the platform engineer:

=== Run the Template

. Access https://backstage-backstage.{openshift_cluster_ingress_domain}[{product_name_rhdh}^, window="rhdh"].
. Click the *Create* icon (plus symbol) in the top menu.
+
image:m3/rhdh-create.png[The {product_name_rhdh} Create UI]
. Click the *Choose* button on the *Quarkus Service*. The Template parameters collection screen will be displayed.
. In Step 1, you'll be prompted to enter a set of application parameters. Thankfully, defaults are provided by the template, so you can simply click *Next*.
. In Step 2, when prompted to *Provide Image Registry Information*:
  * Select the *Quay* image registry.
  * Enter your Quay password: `{common_password}`
  * Click *Next*.
+
NOTE: Your username is automatically determined by the Template using your current session.
+
image:m3/template-quarkus-pg-fake-ai.png[] 
. Oups ! This is a template generated by an *amazing over-trained AI model*.. Hopefully, you are enough smart to correct the work did by the dummy AI !

=== Update the Template with a human touch !
image:m3/template-quarkus-pg-fake-edit-button.png[] 

. Click on the 3 dots button as shown on the picture
+
image:m3/quarkus-service-step3.png[] 

Remember Templates imported previously are located in Gitlab. We will directly edit it and commit it !

*Update the titles of form inputs*
. Titles are located here : 

```yaml
 spec:
  owner: rhdh
  type: service
  parameters:
    - title: Prompt me something ..
```


. Find the YAML surrounded by `update the title below` and replace the title

  * *Prompt me something* by *OpenShift Cluster URL*

image:/m3/template-quarkus-pg-fake-edit-title.png[Customizing the Title]
. Scroll down and enter a commit message `feat: change application title`.
. Click the *Commit changes* button.

*Refresh the template updated ...*
image:/m3/template-quarkus-pg-fake-edit-title.png[Customizing the Title]

Templates are refreshed asynchronously by Red Hat Developer Hub. We will see how to refresh it manually.
image:/m3/template-location-steps.png[Customizing the Title]

Let's find the template to refresh !

. Step *1* - Click on *Catalog*
. Step *2* - Select *Template* type
. Step *3* - Choose the template to refresh

Let's refresh the template !

image:/m3/template-refresh-button.png[Customizing the Title]

. Click on *circle arrows*

Validate the changes on the template by clicking on *Create*


. Confirm you're satisfied with your parameters and click *Create*. These will be passed to the scaffolder when it runs the https://gitlab-gitlab.{openshift_cluster_ingress_domain}/rhdh/template-quarkus-simple/-/blob/main/template.yaml[steps defined in the template, window="gitlab"].
+
image:m3/rhdh-template-quarkus-pg-refreshed.png[Reviewing template parameters in {product_name_rhdh}]

NOTE: The template definition is tied to its definition in the git repository. No GitOps mecanism involved here



*Explore a true step definition*

Remember, the platform engineering helps developers to integrate development tools seamessly in a project. To do so, we rely on plugins to do the job. it proposes a set of *actions*
For instance, to create a simple Gitlab repository, we use the concept of *action*    

```yaml
 - id: publish
      name: Publish
      action: publish:gitlab
      input:
        repoUrl: "${{ parameters.repo.host }}.${{ parameters.openshiftCluster }}?owner=${{ user.entity.metadata.name }}&repo=${{parameters.component_id}}"
        repoVisibility: public
```
The *repoUrl* is built with informations set in the form. The repository will be created with in Gitlab user space *user.entity.metadata.name* and the repository name will be *component_id* set in the Java Package Information section


*Explore the catalog-info.yaml*


As the platform engineering is the entrypoint for project developments, get the right overview of objects created, integrations performed is paramount !
This is why the *catalog-info.yaml* exists ! A clear definition of UI elements based on external tools involved in the development project.

image:m3/rhdh-template-success.png[A successful template run in {product_name_rhdh}]


=== Inspect the new Component and Container Image

Click the *Open Component in catalog* link to view the new `my-quarkus-component` Component. 

You'll see links to the GitLab repository (*View Source* link) and note that you're listed as the owner since your identity was passed to the skeleton code used to create the https://gitlab-gitlab.apps.{openshift_cluster_ingress_domain}/dev1/my-quarkus-app/-/blob/main/catalog-info.yaml?ref_type=heads[Component's *catalog-info.yaml* file, window="gitlab"]. 

NOTE: You can see the user identity `values` being passed to the `fetch:template` action in the https://gitlab-gitlab.{openshift_cluster_ingress_domain}/rhdh/template-quarkus-simple/-/blob/main/template.yaml[template.yaml, window="gitlab"].

image:m3/rhdh-new-component.png[A successful template run in {product_name_rhdh}]

Select the *CI* tab to view the status of the OpenShift Pipelines (Tekton) build. It might take a moment or two for the currently to appear in the *Pipeline Runs* pane. The Pipeline Run is triggered by a set of build manifests that were created in a separate GitOps repository from the Quarkus application's source code - you can find the manifests in the https://gitlab-gitlab.{openshift_cluster_ingress_domain}/dev1/my-quarkus-app-gitops/-/tree/main/helm/quarkus-build[helm/quarkus-build, window="gitlab"] folder. The GitOps Application responsible for applying the build manifests can be seen in the https://gitlab-gitlab.{openshift_cluster_ingress_domain}/dev1/my-quarkus-app-gitops/-/blob/main/argocd/argocd-app-dev-build.yaml[*argocd/argocd-app-dev-build.yaml*, window="gitlab"] file that was added to Argo CD by the `argocd:create-resources` action in the https://gitlab-gitlab.{openshift_cluster_ingress_domain}/rhdh/template-quarkus-simple/-/blob/main/template.yaml[*template.yaml*, window="gitlab"].

NOTE: Manifests related to the developer's applications are managed by a second instance of OpenShift GitOps named *rhdh-gitops*. This second instance is used to manage Parasol's development team's applications, whereas the OpenShift GitOps instance you accessed earlier manages platform components - including the second instance of OpenShift GitOps. View the https://openshift-gitops-server-openshift-gitops.{openshift_cluster_ingress_domain}/applications?search=rhdh[rhdh-gitops ArgoCD Application^, window="argo"] by logging in to the *primary* OpenShift GitOps instance using `admin` / `{openshift_gitops_password}`.

image:m3/rhdh-new-component-ci.png[CI status for the Quarkus Service]

Wait for the build to complete, and visit the https://quay.{openshift_cluster_ingress_domain}/user/dev1/[dev1 organization in Quay^, window="quay"]. You'll be able to view the new _my-quarkus-app_ repository and see the newly pushed _latest_ image tag.

image:m3/quay-image-tag.png[Quay Latest Image Tag]

=== Summary

Nice work! You created a new Component and associated source code from a Software Template.

In the next section you'll learn how to enable and disable different plugin integrations with your Components, using OpenShift GitOps (Argo CD) as an example.