:imagesdir: ../../assets/images


= Platform Engineer Activity: Add steps to the template

:imagesdir: ../../assets/images

include::../style.adoc[]

== Find the template to edit!

++++
<div class="pe">
++++


.Log as a Platform Engineer
[%collapsible]
====
include::../login-pe.adoc[]
====



As we did to edit the template previously to correct a title, we will do it again! 
This flow is a new part of the development lifecycle. The platform engineer shares the knowledge about project development onboarding with developers!


++++
</div>
++++

. Access https://backstage-rhdh-{team-id}.{openshift_cluster_ingress_domain}[{product_name_rhdh}^, window="rhdh"].
. Click the *Create* icon (plus symbol) in the top menu.
+
image:m3/rhdh-create.png[The {product_name_rhdh} Create UI]
. Click the *Choose* button on the *OpenCodeQuest - Quarkus CRUD microservice*. The Template parameters collection screen will be displayed.
+
image:m3/template-quarkus-pg-fake-edit-button.png[edit] 

. Click on the 3 dots button as shown in the picture.
+

Remember, Templates imported previously are located in GitLab. We will edit it and commit it inside Gitlab!
+

++++
</div>
++++


== Mind the step!

image:m3/mind-the-step.png[edit] 

*Explore steps definition*

Our template mission is to onboard a developer with the right resources to start inside a GitLab repo and deploy their work seamlessly. 
Accomplish low-value tasks for the developers on behalf of the ops team in the right way.

Remember, the platform engineering helps developers to integrate development tools configured seamlessly in a project. To do so, we rely on plugins to do the job. it proposes a set of *actions*

*Gitlab step definition*

For instance, to create a simple GitLab repository, we use the concept of *action*    

```yaml
 - id: publish
      name: Publish
      action: publish:gitlab
      input:
        repoUrl: "${{ parameters.repo.host }}.${{ parameters.openshiftCluster }}?owner=${{ user.entity.metadata.name }}&repo=${{parameters.component_id}}"
        repoVisibility: public
```
The *repoUrl* is built with information set in the form. The repository will be created within Gitlab user space *user.entity.metadata.name*, and the repository name will be *component_id* set in the Java Package Information section.


*Explore the Software Catalog AKA catalog-info.yaml*


As platform engineering is the entry point for project developments, getting the right overview of objects created and integrations performed is paramount!
This is why the *Software Catalog* exists! A clear definition of UI elements based on the external tools involved in the development project. For instance, pipeline status, source code repositories, registry shortcuts ...

```yaml
 - id: register
      name: Register
      action: catalog:register
      input:
        repoContentsUrl: ${{ steps.publish.output.repoContentsUrl }}
        catalogInfoPath: "/catalog-info.yaml"
```
The template creates a *Software Catalog* thanks to this action in the git repository where your project will live. It will be updatable by developers. We will see how later ..
Check the content here : -> https://gitlab-gitlab.{openshift_cluster_ingress_domain}/pe{team-id}/template-quarkus-simple/-/blob/main/template.yaml[template.yaml, window="gitlab"].


== Uncomment the steps!


. Find the YAML surrounded by `Gitlab Steps` and uncomment below.
+
image:m3/gitlab-register-steps-uncomment.png[edit] 

. Find the YAML surrounded by `publish gitops resources` and `create argoCD resources` and uncomment below.
+
image:m3/gitops-steps-uncomment.png[edit] 

. Scroll down and enter a commit message `uncomment steps`.
. Click the *Commit changes* button.


== Refresh the template updated 



Templates are refreshed asynchronously by Red Hat Developer Hub. We will see how to refresh it manually.

*Let's find the template to refresh !*

. Step *1* - Click on *Catalog*
. Step *2* - Select *Template* type
. Step *3* - Choose the template  *OpenCodeQuest - Quarkus CRUD microservice* to refresh
image:/m3/template-location-steps.png[Customizing the Title]

*Let's refresh the template !*

image:/m3/template-refresh-button.png[Customizing the Title]

. Click on *circle arrows*



== Summary

Nice work! The template is definitely ready to be used! 
Let's developer consume it!


